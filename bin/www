#!/usr/bin/env node
//var debug = require('debug')('PokerRoom');
var config = require('config');
var app = require('../app');
var log = require('libs/log')(module);
var sockjs = require('sockjs');
var Table = require('Table');

//app.set('port', process.env.PORT || 3000);

var server = app.listen(config.get('port'), function() {

  log.debug('Express server listening on port ' + config.get('port'));
});

var sockServe = sockjs.createServer();
sockServe.on('connection', function(conn) {
  log.debug('starting game...');
  var table = new Table(2);
  conn.on('data', function(message) {

      switch(message){
        case 'START_HAND':
          table.startHand();
          conn.write(table.goOn());
          break;
        default:
          var state = table.goOn();
          if(state) conn.write(state);
          else conn.write('END_HAND');
          break;
      }
  });
  sockServe.on('close', function() {});
  });
sockServe.installHandlers(server, {prefix:'/gameproc'});
